{
  "builders": [
    {
      "type": "googlecompute",
      "account_file": "account.json",
      "project_id": "pattern-journal-1568127981392",
      "source_image_family": "debian-10",
      "ssh_username": "packer",
      "zone": "us-west1-a"
    }
  ],
  "provisioners": [
    {
      "type": "file",
      "source": ".ssh",
      "destination": "/home/packer"
    },
    {
      "type": "shell",
      "inline": ["chmod 400 /home/packer/.ssh/id_rsa"]
    },
    {
      "type": "shell",
      "scripts": [
        "apt.sh",
        "postgres.sh",
        "node.sh",
        "github.sh",
        "nginx.sh",
        "lets_encrypt.sh"
      ]
    },
    {
      "type": "shell",
      "inline": [
        "sudo mv /patternjournal/image/nginx.conf /etc/nginx/sites-available/default"
      ]
    },
    {
      "type": "file",
      "source": ".env.prod",
      "destination": "/home/packer/"
    },
    {
      "type": "shell",
      "inline": ["sudo mv /home/packer/.env.prod /patternjournal/.env"]
    },
    {
      "type": "file",
      "source": "gcp-storage-admin-key.json",
      "destination": "/home/packer/"
    },
    {
      "type": "shell",
      "inline": [
        "sudo mv /home/packer/gcp-storage-admin-key.json /patternjournal/gcp-storage-admin-key.json"
      ]
    },
    {
      "type": "shell",
      "inline": [
        "sudo crontab /patternjournal/image/patternjournal.cron"
      ]
    }
  ]
}
